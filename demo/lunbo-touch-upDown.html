<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="这是一个测试">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <title>西厢</title>
  <style type="text/css">
	  *{margin:0;padding:0;font-size:12px;}
	  img{display:block;border:0;}
	  
	  .sass{height:300px;width:100%;position:relative;overflow:hidden;}
	  .sass-item{height:100%;width:100%;position:absolute;top:0;left:0;}

	  .color-1{background:rgb(254,67,101);}
	  .color-2{background:rgb(249,205,173);}
	  .color-3{background:rgb(131,175,155);}
	  .color-4{background:rgb(23,44,60);}
		
	  .change{-webkit-transition:all 0.2s;}

	  .dian{position:absolute;width:100%;height:20px;text-align:center;overflow:hidden;bottom:0;}
	  .dian-item{display:inline-block;height:10px;width:10px;border-radius:10px;background:rgba(255,255,255,0.3);}
	  .dian-item+.dian-item{margin-left:10px;}
	  .dian-item-current{background:rgba(255,255,255,0.8);}
  </style>
 </head>
 <body>
	<div id="" class="main">
		<div id="" class="nav" style="height:100px;width:100%;position:fixed;z-index:1000;top:0;left:0;">
			<div id="" style="background:rgba(255,255,255,0.3);-webkit-filter:blur(2px);height:100px;width:100%;position:absolute;top:0;left:0;"></div>
			<div id="" style="height:100%;width:100%;position:absolute;top:0;left:0;text-align:center;font-size:20px;line-height:100px;">
				念去去，千里烟波,暮霭沉沉楚天阔
			</div>
		</div>
		<div id="less" class="sass">
			<div id="" class="sass-wrap">
				<div class="sass-item color-1"></div>
				<div class="sass-item color-2"></div>
				<div class="sass-item color-3"></div>
				<div class="sass-item color-4"></div>
			</div>
		</div>
	</div>
<script type="text/javascript"src="js/jquery-1.11.2.min.js"></script> 
  <script type="text/javascript">
	$(function(){
		var winHeight =$(window).height();
		var winWidth =$(window).width();
		$('#less').height(winHeight)
		lunbo('less',false,cb);
		function cb(index){
			console.log(index)
		}
		function lunbo(idname,autoPlay,callback){
			var $id = $('#'+idname);
			var $item = $('#'+idname+'>div>div');
			var idWidth = $id.width(),
				idHeight = $id.height();
			var leftMin = -idWidth ,
			    leftCurrent = 0 ,
			    leftMax = idWidth ,
				topMin = -idHeight ,
			    topCurrent = 0 ,
			    topMax = idHeight ,
			    len = $item.length ,
			    timeIn ,
			    currentPage = 0 ;
			$item.not(':first').css({'top':topMax});
			appendDian();
			var $dianItem = $('#'+idname+'>.dian>.dian-item');
			dianMove();
			
			if (autoPlay)//是否自动播放
			{
				start();
			}
			touchMove(idname);//touch事件

			function dianMove(){
				$dianItem.eq(currentPage).addClass('dian-item-current').siblings().removeClass('dian-item-current');
			}
			function appendDian(){
				var dian = '';
				for (var i=0;i<len ;i++ )
				{
					dian = dian+'<span class="dian-item"></span>';
				}
				$id.append('<div class="dian">'+dian+'</div>');
			}

			function start(){
				timeIn=setInterval(move,2000);
			}
			function stop(){
				clearInterval(timeIn);
			}
			function move(){
				$item.removeClass('change');
				if (currentPage < len-1)
				{
					$item.eq(currentPage+1).css({'top':topMax});
					$item.show().addClass('change');
					//console.log($item.eq(currentPage+1).offset().top)
					$item.eq(currentPage).css({'top':topMin});
					$item.eq(currentPage+1).css({'top':0});
					currentPage++;
				}else{
					$item.eq(0).css({'top':topMax});
					$item.show().addClass('change'); //为什么$item.eq(0).css({'top':topMax});$item.addClass('change');前一语句不能正常执行
					$item.eq(currentPage).css({'top':topMin});
					$item.eq(0).css({'top':0});
					currentPage=0;
				}
				dianMove()
			}
			function touchMove(idname){
				var id = document.getElementById(idname);
				var xx,XX,$prev,$next,swipeX,swipeY;
				id.addEventListener('touchstart',function(event){
					stop();
					$item.removeClass('change')
					xx = event.targetTouches[0].screenX;
					yy = event.targetTouches[0].screenY;
					XX = xx ;
					YY = yy ;
					$prev = $item.eq(currentPage-1)[0]?$item.eq(currentPage-1):$item.eq(len-1);
					$prev.css({'top':topMin});
					$next = $item.eq(currentPage+1)[0]?$item.eq(currentPage+1):$item.eq(0);
					$next.css({'top':topMax});
					swipeX = true ;
					swipeY = true ;
				});
				id.addEventListener('touchmove',function(event){
					XX = event.targetTouches[0].screenX;
					YY = event.targetTouches[0].screenY;
					if (swipeX && Math.abs(XX-xx)-Math.abs(YY-yy)>0)
					{
						swipeY = false ;
					}else if(swipeY && Math.abs(XX-xx)-Math.abs(YY-yy)<0){
						swipeX = false
						event.stopPropagation();
						event.preventDefault();
						if (YY-yy>0)
						{
							$item.eq(currentPage).css({'top':topCurrent+YY-yy});
							$prev.css({'top':topMin+YY-yy});
							$next.css({'top':topMax});// 避免因为滑动过快引起的bug
						}else if (YY-yy<=0)
						{
							$item.eq(currentPage).css({'top':topCurrent+YY-yy});
							$next.css({'top':topMax+YY-yy});
							$prev.css({'top':topMin});// 避免因为滑动过快引起的bug
						}
					}
				});
				id.addEventListener('touchend',function(event){
					$item.addClass('change');
					if (swipeY)
					{
						if (YY-yy>0)
						{
							if (YY-yy>50)
							{
								$item.eq(currentPage).css({'top':topMax});
								$prev.css({'top':topCurrent});
								currentPage--;
								setPage(currentPage);
							}else{
								$item.eq(currentPage).css({'top':topCurrent});
								$prev.css({'top':topMin});
							}
						}else if (YY-yy<=0)
						{
							if (YY-yy<-50)
							{
								$item.eq(currentPage).css({'top':topMin});
								$next.css({'top':topCurrent});
								currentPage++;
								setPage(currentPage);
							}else{
								$item.eq(currentPage).css({'top':topCurrent});
								$next.css({'top':topMax});
							}
						}
					}
					if (autoPlay)
					{
						start();
					}
					dianMove();
					if (callback)
					{
						callback(currentPage);
					}
				});
			}
			function setPage(page){ //设置page
				if (currentPage>len-1)
				{
					currentPage=0;
				}else if (currentPage<0)
				{
					currentPage=len-1;
				}
			}
		}


	});
</script>
 </body>
</html>
