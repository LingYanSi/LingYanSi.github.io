<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="这是一个测试">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <link rel="shortcut Icon" href="img/shortcut.jpg">
  <title>西厢</title>
  <style type="text/css">
  *{margin:0;padding:0;font-size:12px;}
  img{display:block;border:0;}
  .main{background:red;background: linear-gradient(0deg, #fff 0%,#93ddab 44%,#20B2AA 100%);}

  .top{width:562px;margin:0 auto;padding:20px 0;overflow:hidden;}
  .logo{display:inline-block;float:left;}
  .logo img{margin:0 auto;}
  .all_visitor{text-align:center;height:50px;line-height:50px;font-size:20px;font-family:'楷体'}

  .login_area{margin-left:50px;width:212px;height:150px;padding-top:122px;display:inline-block;float:left;}
  .xx_input{width:200px;height:30px;padding:0 5px;}
  .sub{height:30px;width:60px;}
  p + p{margin-top:10px;}


  </style>
 </head>
 <body>
		<div id="" class="main">
			<div id="" class="top">
				<div id="" class="logo">
					<img src="img/logo.jpg" width="300" height="300" border="0" alt="">
					<div id="all_visitor" class="all_visitor"></div>
				</div>
				
				<div id="" class="login_area">
					<p><input type="text" class='xx_input' placeholder='用户名' id='username' name=""></p>
					<p><input type="password" class='xx_input' placeholder='密码' id='password' name=""></p>
					<p><button class='sub' id='sub'>登录</button></p>
				</div>
			</div>
			
		</div>
<script type="text/javascript"src="js/jquery-1.9.0.min.js"></script>   
  <script type="text/javascript">
	$(function(){
		function getCookie(c_name)//获取cookie
		{
			if (document.cookie.length>0)
			{
				c_start=document.cookie.indexOf(c_name + "=");//获取'c_name='在cookie中第一次出现的位置
				if (c_start!=-1)
				{ 
					c_start=c_start + c_name.length+1 ;//用来获取字符串

					c_end=document.cookie.indexOf(";",c_start);
					if (c_end==-1) //若果没有发现分号‘;’
					{
						c_end=document.cookie.length;//就把cookie的长度付给c_end
					}
					return decodeURIComponent(document.cookie.substring(c_start,c_end));//最后将截取的cookie字符串中的一段解码返回
				 } 
			 }
			else{return ""}
		}

		function setCookie(c_name,name_value,c_pass,pass_value,expiredays)//设置cookie，expiredays为cookie的有效期，c_name,value类似json对象
		{
			var exdate=new Date();
			exdate.setDate(exdate.getDate()+expiredays);//设置时间
			//document.cookie=c_name+ "=" +decodeURI(name_value)+';'+c_pass+'='+decodeURI(pass_value)+((expiredays==null) ? "" : ";expires="+exdate.toGMTString());
			document.cookie = c_name+ "=" +decodeURI(name_value) + ((expiredays==null) ? "" : ";expires="+exdate.toGMTString())+";path=/";
			document.cookie = c_pass+'='+ decodeURI(pass_value) + ((expiredays==null) ? "" : ";expires="+exdate.toGMTString())+";path=/";
									//decodeURI用以编码value，(expiredays==null) ? "" : ";expires="+exdate.toGMTString()
									//后面这句话的意思是：如果没有设置cookie，就不执行什么，如果不为空，就设置expires的日期
		}

		function checkCookie()//核对cookie与服务器用户名密码是否相同，相同则加载一些东西，不同则重新输入
		{
			//setCookie('username','xiaofan','password','xiaofan',30);
			var username=getCookie('username');
			if (username!=null && username!="")//若果你能够获取到cookie,就和服务器的用户名和密码比较
			{//alert(username)
				$('#username').val(username);
			}
			var password=getCookie('password');
			
			if (password!=null && password!="")//若果你能够获取到cookie,就和服务器的用户名和密码比较
			{
				$('#password').val(password);
			}
		}
		checkCookie();
		$.ajax({ 
                async: true, 
                url: "vistor.php", 
                type: "get", 
                dataType: 'json',
                jsonp: 'jsoncallback', 
                data: null, 
                contentType: "application/json;utf-8", 
                success:function (data, textStatus){
					$('#all_visitor').text(data);
				}, 
                error: function (jqXHR, textStatus, errorThrown) { 
                    alert('第一错误'); 
                } 
          });
		
		
		if ($('.main').height()<$(window).height())
		{
			$('.main').css({'padding-top':($(window).height()-$('.main').height())/3})
		}
		$(window).resize(function(){
			if ($('.main').height()<$(window).height())
			{
				$('.main').css({'padding-top':($(window).height()-$('.main').height())/3})
			}
		});


		$('#sub').click(function(){
			if ($('#username').val().length>0 && $('#password').val().length>0)
			{
				var user_val = $('#username').val();
				var pass_val = $('#password').val();
				setCookie('username',user_val,'password',pass_val,30);
				//alert(pass_val)
				$.ajax({
					async: true, 
					url: "login.php", 
					type: "post", 
					dataType: 'json',
					jsonp: 'jsoncallback', 
					data: {username : user_val ,
							password : pass_val
					}, 
					//contentType: "application/json;utf-8", 
					success:function (data, textStatus){
						if(data.user=='通过')
						{
							if (document.referrer==''||document.referrer==window.location.href)//如果本页面的【前一个url为空，或者与本页面url相同，或者非同一个网站】则跳向主页
							{
								window.location.href='index.html';
							}
							else{window.location.href = document.referrer;}//document.referrer会返回本页面浏览记录的上一个url
						}
						else{alert('用户名或者密码错误')}
					}, 
					error: function (jqXHR, textStatus, errorThrown) { 
						alert('无法登陆'); 
					} 
				});
			}
			else{alert('用户名或者密码不能为空')}
		})
	})
</script>
 </body>
</html>
