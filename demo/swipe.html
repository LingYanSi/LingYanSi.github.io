<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="这是一个测试">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <title>灵岩</title>
  <style type="text/css">
	  *{margin:0;padding:0;}
	  img{display:block;border:0;max-width:100%;height:auto;}

	  .main_wrap{width:100%;overflow:hidden;background:rgb(23,44,60);}
	  .reload-tips{text-align:center;color:rgb(247,104,104);font-size:1.2em;line-height:3em;}
	  .main{width:100%;background:rgba(0,255,255,0.6);position:absolute;top:0;left:0;}
	  .swipe{-webkit-transition:all 0.3s;-webkit-transition-timing-function: cubic-bezier(0,0,0.25,1);}

	  .bitch{width:100%;height:200px;background:pink;position:relative;overflow:hidden;}
		
	  .nav-wrap{height:50px;position:relative;}
	  .nav{height:50px;width:100%;background:rgb(254,67,101);text-align:center;line-height:50px;z-index:1000;}
	  .nav-fixed{position:fixed;top:0;left:0;}

	  .sass{height:300px;width:100%;position:relative;overflow:hidden;}
	  .sass-item{height:100%;width:100%;position:absolute;top:0;left:0;}

	  .color-1{background:rgb(254,67,101);}
	  .color-2{background:rgb(249,205,173);}
	  .color-3{background:rgb(131,175,155);}
	  .color-4{background:rgb(23,44,60);}
		
	  .change{-webkit-transition:left 0.35s;-webkit-transition-timing-function: cubic-bezier(0,0,0.25,1);}

	  #inner{width:50%;}

	  .dian{position:absolute;width:100%;height:20px;text-align:center;overflow:hidden;bottom:0;}
	  .dian-item{display:inline-block;height:10px;width:10px;border-radius:10px;background:rgba(255,255,255,0.3);}
	  .dian-item+.dian-item{margin-left:10px;}
	  .dian-item-current{background:rgba(255,255,255,0.8);}
  </style>
 </head>
 <body>
	<div id="main_wrap" class="main_wrap">
		<div id="reload-tips" class="reload-tips">
			下拉刷新
		</div>
		<div id="main" class="main">
			<div id="" class="main-item">
				<div id="sass" class="sass">
					<div id="" class="sass-wrap">
						<div class="sass-item color-1">
							<div id="inner" class="sass">
								<div id="" class="sass-wrap">
									<div class="sass-item color-1"></div>
									<div class="sass-item color-2"></div>
									<div class="sass-item color-3"></div>
									<div class="sass-item color-4"></div>
								</div>
							</div>
						</div>
						<div class="sass-item color-2"></div>
						<div class="sass-item color-3"></div>
						<div class="sass-item color-4"></div>
					</div>
				</div>
				<div id="" class="nav-wrap">
					<div id="nav" class="nav">千山我独行</div>
				</div>
				<img src="img/1.jpg" width="320" height="640" border="0" alt="">
				<p id="sY" style="position:fixed;top:0;left:0;height:50px;width:100px;background:#ffffff;"></p>
				<p id="aY" style="position:fixed;top:0;right:0;height:50px;width:100px;background:#ffffff;"></p>
				<div id="bitch" class="bitch">
					<div id="" class="sass-wrap">
						<div class="sass-item color-1"></div>
						<div class="sass-item color-2"></div>
						<div class="sass-item color-3"></div>
						<div class="sass-item color-4"></div>
					</div>
				</div>
				<div id="zhang" class="bitch">
				</div>
			</div>
			<div id="" class="main-item color-2">
				
			</div>
		</div>
	</div>
<script type="text/javascript"src="js/jquery-1.11.2.min.js"></script> 
  <script type="text/javascript">
	$(function(){
		var height =$(window).height();
		var width =$(window).width();
		var main = document.getElementById('main');
		document.getElementById('main_wrap').style.height = height+"px";
		var sY = document.getElementById('sY');
		window.onload = function(){
			swipe('main');
		}
		setInterval(function(){ //监听top值变化，用以决定导航栏状态
			if ($('#main').offset().top<=-300)
			{
				$('#nav').addClass('nav-fixed');
			}else{
				$('#nav').removeClass('nav-fixed');
			}	
		},5);
		lunbo('sass',false);
		lunbo('inner',true);
		lunbo('bitch',false);
		//swipeH('bitch');
		swipeH('zhang');
		function swipe(idName){
			var xx,yy,xX,yY,top,left;
			var swipeX,swipeY;
			var swipeDirection ;
			var id = document.getElementById('main');
			var thisTopMin = height - $(id).height() ;
			var swipeDistance = 400 ;//滑动结束后，top变化值
			//滑动速率，用以计算在最后时刻，是否应该触发top变化，以及top变化速率 
			var top1 = 0;
			var top2 = 0;
			var getTop ;
			id.addEventListener('touchstart',function(event){ //触摸开始
				$(id).removeClass('swipe');
				swipeX=true;
				swipeY=true;
				xx = event.targetTouches[0].screenX;
				yy = event.targetTouches[0].screenY;
				top = id.offsetTop; 
				left = id.offsetLeft ;
				//console.log(top)
				xX = xx ;
				yY = yy ;
			});
			id.addEventListener('touchmove',function(event){ //触摸中
				event.preventDefault();
				xX = event.targetTouches[0].screenX;
				yY = event.targetTouches[0].screenY;
				sY.innerHTML = id.offsetTop+'';//测试是否连续变化
				top1 = yY ;
				if (Math.abs(yY-yy)>Math.abs(xX-xx) && swipeY)//判断上下还是左右滑动，且只能向一个方向滑动
				{
					swipeX = false ;
					getTop = setInterval(function(){
						top2 = top1 ;
						top1 = id.offsetTop;
					},100);
					if (yY-yy>0)
					{
						swipeDirection = "swipeDown";
					}
					else{
						swipeDirection = "swipeUp";
					}
					id.style.top = (top+yY-yy)+'px';
				}
			});
			id.addEventListener('touchend',function(event){ //触摸结束
				$(id).addClass('swipe');
				clearInterval(getTop);//清除对top值的获取
				switch (swipeDirection)
				{
					case 'swipeDown':
						if (top==0 && id.offsetTop>=20)
						{
							$('#reload-tips').text('正在刷新中');
							setTimeout(function(){
								id.style.top="0px";
							},100);
							setTimeout(function(){
								location.reload();
							},400);
						}else{
							if (Math.abs(id.offsetTop-top2)>5 || id.offsetTop>0)//判断是否继续滑动，如果最后时刻有停顿则不滑动
							{
								if (id.offsetTop+swipeDistance<0)
								{
									id.style.top = (id.offsetTop+swipeDistance)+"px";
								}else{
									id.style.top="0px";
								}
							}
						}
						break;
					case "swipeUp":
						if (Math.abs(id.offsetTop-top2)>5 || id.offsetTop<thisTopMin)
						{
							if (id.offsetTop-swipeDistance>thisTopMin)
							{
								id.style.top = (id.offsetTop-swipeDistance)+"px";
							}
							else {id.style.top= thisTopMin+"px"}
						}
						break;
				}
			});
		}
		/*
			因为有些时候图片左右滑动之余，还需要上下滑动，用以冒泡到父级元素
			也就说swipe父级元素的上下滑动需要独立出来，以便其他事件的调用
		*/
		function swipeH(idName){
			var xx,yy,xX,yY,top,left,mainTop;
			var swipeX,swipeY;
			var swipeDirection ;
			var top1 = 0;
			var top2 = 0;
			var getTop ;
			var swipeDistance = 400 ;//滑动结束后，top变化值
			var thisTopMin = height - $(main).height() ;
			var id = document.getElementById(idName);
			var aY = document.getElementById("aY");
			id.addEventListener('touchstart',function(e){ //触摸开始
					event.stopPropagation();
				//e.stopPropagation();
				$(id).removeClass('swipe');
				$(main).removeClass('swipe');
				swipeX=true;
				swipeY=true;
				xx = e.targetTouches[0].screenX;
				yy = e.targetTouches[0].screenY;
				top = id.offsetTop; 
				//top2 = top ;
				//top1 = top ;
				mainTop = main.offsetTop ;
				left = id.offsetLeft ;
				xX = xx ;
				yY = yy ;
			});
			id.addEventListener('touchmove',function(e){ //触摸中
				e.stopPropagation();
				event.preventDefault();
				xX = e.targetTouches[0].screenX;
				yY = e.targetTouches[0].screenY;
				top1 = main.offsetTop;
				if (Math.abs(yY-yy)<Math.abs(xX-xx) && swipeX)//判断向左、向右滑动，且只能向一个方向滑动
				{
					swipeY = false ;
					id.style.left = (left+xX-xx)+'px';
					aY.innerHTML = id.offsetLeft + 'px';
				}
				if(Math.abs(yY-yy)>Math.abs(xX-xx) && swipeY)//判断向左、向右滑动，且只能向一个方向滑动
				{
					swipeX = false ;
					getTop = setInterval(function(){
						top2 = top1 ;
						top1 = main.offsetTop;
					},10);
					if (yY-yy>0)
					{
						swipeDirection = "swipeDown";
					}
					else if(yY-yy<0){
						swipeDirection = "swipeUp";
					}
					main.style.top = (mainTop+yY-yy)+'px';
				}
			});
			id.addEventListener('touchend',function(e){ //触摸结束
				e.stopPropagation();
				if (swipeX)
				{
					$(id).addClass('swipe');
					id.style.left = "0px";
				}if(swipeY){
					$(main).addClass('swipe');
					clearInterval(getTop);//清除对top值的获取
					switch (swipeDirection)
					{
						case 'swipeDown':
							if (mainTop==0 && main.offsetTop>=20)
							{
								$('#reload-tips').text('正在刷新中');
								setTimeout(function(){
									main.style.top="0px";
								},100);
								setTimeout(function(){
									location.reload();
								},400);
							}else{
								if (Math.abs(main.offsetTop-top2)>5 || main.offsetTop>0)//判断是否继续滑动，如果最后时刻有停顿则不滑动
								{
									if (main.offsetTop+swipeDistance<0)
									{
										main.style.top = (main.offsetTop+swipeDistance)+"px";
									}else{
										main.style.top="0px";
									}
								}
							}
							break;
						case "swipeUp":
							if (Math.abs(main.offsetTop-top2)>5 || main.offsetTop<thisTopMin)
							{
								if (main.offsetTop-swipeDistance>thisTopMin)
								{
									main.style.top = (main.offsetTop-swipeDistance)+"px";
								}
								else {main.style.top= thisTopMin+"px"}
							}
							break;
					}
				}
			});
		}

		function lunbo(idname,autoPlay){
			var $id = $('#'+idname);
			var $item = $('#'+idname+'>div>div');
			var idWidth = $id.width();
			var leftMin = -idWidth ,
			    leftCurrent = 0 ,
			    leftMax = idWidth ,
			    len = $item.length ,
			    timeIn ,
			    currentPage = 0 ;

			$item.not(':first').css({'left':leftMax});
			appendDian();
			var $dianItem = $('#'+idname+'>.dian>.dian-item');
			dianMove();
			
			if (autoPlay)//是否自动播放
			{
				start();
			}
			touchMove(idname);//touch事件

			function dianMove(){
				$dianItem.eq(currentPage).addClass('dian-item-current').siblings().removeClass('dian-item-current');
			}
			function appendDian(){
				var dian = '';
				for (var i=0;i<len ;i++ )
				{
					dian = dian+'<span class="dian-item"></span>';
				}
				$id.append('<div class="dian">'+dian+'</div>');
			}

			function start(){
				timeIn=setInterval(move,2000);
			}
			function stop(){
				clearInterval(timeIn);
			}
			function move(){
				$item.removeClass('change');
				if (currentPage < len-1)
				{
					$item.eq(currentPage+1).css({'left':leftMax});
					$item.show().addClass('change');
					//console.log($item.eq(currentPage+1).offset().left)
					$item.eq(currentPage).css({'left':leftMin});
					$item.eq(currentPage+1).css({'left':0});
					currentPage++;
				}else{
					$item.eq(0).css({'left':leftMax});
					$item.show().addClass('change'); //为什么$item.eq(0).css({'left':leftMax});$item.addClass('change');前一语句不能正常执行
					$item.eq(currentPage).css({'left':leftMin});
					$item.eq(0).css({'left':0});
					currentPage=0;
				}
				dianMove()
			}
			function touchMove(idname){
				var id = document.getElementById(idname);
				var xx,XX,yy,YY,$prev,$next,swipeY,swipeX;
			
				var swipeDirection ;
				var top1 = 0;
				var top2 = 0;
				var getTop ;
				var swipeDistance = 400 ;//滑动结束后，top变化值
				var mainTop,thisTopMin ;
				id.addEventListener('touchstart',function(event){
					event.stopPropagation();
					stop();
					$item.removeClass('change');
					swipeY = true ;
					swipeX = true ;
					xx = event.targetTouches[0].screenX;
					yy = event.targetTouches[0].screenY;
					XX = xx ;
					YY = yy ;
					$prev = $item.eq(currentPage-1)[0]?$item.eq(currentPage-1):$item.eq(len-1);
					$prev.css({'left':leftMin});
					$next = $item.eq(currentPage+1)[0]?$item.eq(currentPage+1):$item.eq(0);
					$next.css({'left':leftMax});

					//top2 = top ;
					//top1 = top ;
					mainTop = main.offsetTop ;
					$(main).removeClass('swipe');
				    thisTopMin = height - $(main).height() ;
				});
				id.addEventListener('touchmove',function(event){
					event.stopPropagation();
					event.preventDefault();
					XX = event.targetTouches[0].screenX;
					YY = event.targetTouches[0].screenY;
					if(Math.abs(YY-yy)<Math.abs(XX-xx) && swipeX)
					{
						swipeY = false ;
						if (XX-xx>=0)
						{
							$item.eq(currentPage).css({'left':leftCurrent+XX-xx});
							$prev.css({'left':leftMin+XX-xx});
						}else
						{
							$item.eq(currentPage).css({'left':leftCurrent+XX-xx});
							$next.css({'left':leftMax+XX-xx});
						}
					}
					if (Math.abs(YY-yy)>Math.abs(XX-xx) && swipeY)
					{
						swipeX = false ;
						top1 = main.offsetTop ;
						getTop = setInterval(function(){
							top2 = top1 ;
							top1 = main.offsetTop;
						},100);
						if (YY-yy>0)
						{
							swipeDirection = "swipeDown";
						}
						else if(YY-yy<0){
							swipeDirection = "swipeUp";
						}
						main.style.top = (mainTop+YY-yy)+'px';
					}
				});
				id.addEventListener('touchend',function(event){
					event.stopPropagation();
					$item.addClass('change');
					if (swipeX)
					{
						if (XX-xx>0)
						{
							$item.eq(currentPage).css({'left':leftMax});
							$prev.css({'left':leftCurrent});
							$next.css({'left':leftMax});
							currentPage--;
							setPage(currentPage);
						}else if (XX-xx<0)
						{
							$item.eq(currentPage).css({'left':leftMin});
							$next.css({'left':leftCurrent});
							$prev.css({'left':leftMin});
							currentPage++;
							setPage(currentPage);
						}
						if (autoPlay)
						{
							start();
						}
						dianMove();
					}
					if (swipeY)
					{
						$(main).addClass('swipe');
						clearInterval(getTop);//清除对top值的获取
						switch (swipeDirection)
						{
							case 'swipeDown':
								if (mainTop==0 && main.offsetTop>=20)
								{
									$('#reload-tips').text('正在刷新中');
									setTimeout(function(){
										main.style.top="0px";
									},100);
									setTimeout(function(){
										location.reload();
									},400);
								}else{
									if (Math.abs(main.offsetTop-top2)>5 || main.offsetTop>0)//判断是否继续滑动，如果最后时刻有停顿则不滑动
									{
										if (main.offsetTop+swipeDistance<0)
										{
											main.style.top = (main.offsetTop+swipeDistance)+"px";
										}else{
											main.style.top="0px";
										}
									}
								}
								break;
							case "swipeUp":
								if (Math.abs(main.offsetTop-top2)>5 || main.offsetTop<thisTopMin)
								{
									if (main.offsetTop-swipeDistance>thisTopMin)
									{
										main.style.top = (main.offsetTop-swipeDistance)+"px";
									}
									else {main.style.top= thisTopMin+"px"}
								}
								break;
						}
					}
				});
			}
			function setPage(page){ //设置page
				if (currentPage>len-1)
				{
					currentPage=0;
				}else if (currentPage<0)
				{
					currentPage=len-1;
				}
			}
		}
	});
</script>
 </body>
</html>
