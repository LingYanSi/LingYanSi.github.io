<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta name="apple-mobile-web-app-capable" content="yes" /> 
  <meta name="screen-orientation" content="portrait">
  <meta name="browsermode" content="application">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-title" content="多聚">
  <meta content="telephone=no" name="format-detection">
  <link rel="shortcut icon" href="" />
  <link rel="stylesheet" href="css/reset.css" type="text/css"/>
  <title></title>
  <style type="text/css">
	  
	  .main{padding-top:0;width:100%;max-width:900px;margin:0 auto;background:rgb(239,239,239);}
	  
	  img{max-width:100%;height:auto;display:block;margin:0 auto;}
	  .main>img{background-color:rgba(0,255,255,0.5);background-image:linear-gradient(45deg,rgb(214,104,104),rgb(0,255,255));}

	  .layer-wrap{height:100%;width:100%;position:fixed;top:0;left:0;background-color:rgba(0,0,0,0.4);background-color:rgb(100,100,100)\0;z-index:1000;display:none;}
	  .layer{width:10px;height:10px;margin:0 auto;overflow:hidden;position:relative;background-color:rgb(255,255,255);}
	  .layer-transition{transition:all 0.2s ease-out;transition:all 0.2s ease-out;height:80%;width:80%;}

	  .layer-img{height:100%;width:100%;position:relative;cursor:pointer;}
	  .layer-img>img{max-height:100%;max-width:100%;}

	  .layer-left,.layer-right{position:absolute;height:50px;width:50px;top:50%;background-color:rgb(247,104,104);overflow:hidden;}
	  .layer-left{left:0;}
	  .layer-right{right:0;}

	  .layer-tips{position:absolute;width:200px;height:50px;line-height:50px;text-align:center;border:dashed 2px red;top:-100%;left:50%;transition:top 0.5s;}
	  .layer-tips-transition{top:50%;}

	  .layer-img-nav{width:100%;height:50px;line-height:50px;text-align:center;position:absolute;bottom:0;left:0;color:rgb(247,104,104);}
	  .layer-img-index{font-size:2em;}
	  .layer-img-len{font-size:0.5em;}
  </style>
 </head>
 <body>
	<div id="wrap" class="wrap">
		<div id="main" class="main">
			<img data-url="img/1.jpg" alt="" />
			<img data-url="img/2.jpg" alt="" />
			<img data-url="img/3.jpg" alt="" />
			<img data-url="img/4.jpg" alt="" />
		</div>
		<div id="" class="">
			<img src="img/134.jpg" alt="" />
		</div>
	</div>
	<div id="layer-wrap" class="layer-wrap">
		<div id="layer" class="layer">
			<div id="layer-img" class="layer-img" onselectstart="return false;" style="-moz-user-select:none;"></div>
			<div id="layer-left" class="layer-left"></div>
			<div id="layer-right" class="layer-right"></div>
			<div id="layer-tips" class="layer-tips">已是最后一张，点击重新浏览</div>
			<div id="layer-img-nav" class="layer-img-nav">
				<span class="layer-img-index" id="layer-img-index"></span>/<span class="layer-img-len" id="layer-img-len"></span>
			</div>
		</div>
	</div>
 <script src="js/jquery-1.11.2.min.js"></script>
 <script type="text/javascript">
	$(function(){
		var winHeight = $(window).height() ;
		var winWidth = $(window).width() ;
		// 图片延时加载，目的在于当单页面有大量图片加载的时候，可能会造成图片加载阻塞，没有次序加载
		//延时加载，可以精确的控制加载次序，最起码可以优先加载重要图片
		//实现思路：当dom树加载完毕后，替换img标签的src对象，存储图片路径，然后伺机再将图片复原//这种方法的弊端在于会重复访问服务器造成性能浪费
		//因此可以使用自定义属性【data-url】来存储图片
		//比如知乎客户端的图片显示，也是先显示一个动态gif，当图片加载成功后再显示
		//对于【像weibo查看大图，也是同样的解决思路】
		//点击查看大图【从服务器获取，或者是图片命名遵循统一规则】，查看到谁再加载，不要一次性加载，浪费流量，也给服务器添加负担

		loadImg('main',5000);
		function loadImg(idname,time){
			var imgSrc = [];
			var $img = $('#'+idname+'  img') ;
			$img.each(function(){
				var src = $(this).attr('data-url');
				imgSrc.push(src);
			});
			setTimeout(function(){
				$img.each(function(){
					$(this).attr('src',imgSrc.shift());
					$(this)[0].onload = function(){
						$(this).css({'display':'block'});
					}
				});
			},time);
		}

		setStyle();
		function setStyle(){
			winHeight = $(window).height() ;
		    winWidth = $(window).width() ;
			$('#layer').css({'margin-top':(winHeight-$('#layer').height())/2})
		}
		layer('.main');
		function layer(selector){
			var $layerImg = $('#layer-img')
			$layerImg.mousemove(function(event){
				if (event.pageX>=$layerImg.offset().left+$layerImg.width()/2)
				{
					$(this)[0].style.cursor = "url(img/icon/arrow-thick-right-6x.png),default";
				}else{
					$(this)[0].style.cursor = "url(img/icon/arrow-thick-left-6x.png),default";
				}
			});
			$layerImg.click(function(){
				if (event.pageX>=$layerImg.offset().left+$layerImg.width()/2)
				{
					layerImgNext();
					return false;
				}else{
					layerImgPrev();
					return false;
				}
			})
			var imgSrc = [];
			var index,imgSrcLen;
			$(selector).find('img').click(function(){
				imgSrc = [];
				var $img = $(this).parent().find('img') ;
				$img.each(function(){
					var src = $(this).attr('src');
					imgSrc.push(src);
				});
				imgSrcLen = imgSrc.length ;
				index = $(this).index();
				$('#layer-img-index').text(index+1);
				$('#layer-img-len').text(imgSrcLen);
				$('#layer-wrap').show();
				$('#layer').css({'margin-top':($(window).height()-$('#layer').height())/2});
				$('#layer-img').empty().append('<img src="'+imgSrc[index]+'" alt="" />');
				$('#layer-img').find('img').hide();
				$('#layer-img').find('img')[0].onload= function(){
					var $this = $(this);
					imgLoad = true;
					if (over)
					{
						$this.css({'padding-top':($('#layer-img').height()-$this.height())/2})
						console.log($('#layer-img').height()+'--'+$this.height());
						$this.show();
					}
				}
				var imgLoad = false;
				var over = false ;
				setTimeout(function(){ 
					$('#layer').addClass('layer-transition').css({'margin-top':$(window).height()/10});
				},10);
				setTimeout(function(){
					over = true;
					if (imgLoad)
					{
						$('#layer-img').find('img').css({'padding-top':($('#layer-img').height()-$('#layer-img').find('img').height())/2});
						$('#layer-img').find('img').show();
					}
				},210);
				
			});
			$('#layer-wrap').click(function(){
				$('#layer-wrap').hide().find('#layer').removeClass('layer-transition');
			});
			$('#layer').click(function(event){
				event.stopPropagation();
			});
			$('#layer-left').click(function(){
				layerImgPrev();
			});
			$('#layer-right').click(function(){
				layerImgNext();
			});
			function layerImgNext(){
				index++;
				index = resetPage(index,imgSrcLen);
				$('#layer-img-index').text(index+1);
				$('#layer-img').empty().append('<img src="'+imgSrc[index]+'" alt="" />');
				$('#layer-img').find('img').hide();
				$('#layer-img').find('img')[0].onload= function(){
					var $this = $(this);
					console.log($this.height())
					var $layer = $('#layer');
					$this.css({'padding-top':($('#layer-img').height()-$this.height())/2})
					$this.show();
				}
			}
			function layerImgPrev(){
				index--;
				index = resetPage(index,imgSrcLen);
				$('#layer-img-index').text(index+1);
				$('#layer-img').empty().append('<img src="'+imgSrc[index]+'" alt="" />');
				$('#layer-img').find('img').hide();
				$('#layer-img').find('img')[0].onload= function(){
					var $this = $(this);
					console.log($this.height())
					var $layer = $('#layer');
					$this.css({'padding-top':($('#layer-img').height()-$this.height())/2})
					$this.show();
				}
			}
			$(window).resize(function(){
				setStyle();
				$('#layer-img').find('img').css({'padding-top':($('#layer-img').height()-$('#layer-img').find('img').height())/2});
				console.log($('#layer-img').height()+'----'+$('#layer-img').find('img').height())
			});
			function layerTipsShow(){
				$('#layer-tips').addClass('layer-tips-transition')
			}
		}
		function resetPage(page,maxLen){
			if (page > maxLen-1)
			{
				page=0;
			}else if (page < 0)
			{
				page = maxLen-1;
			}
			return page
		}
		function setImgSize(img,parent){
			var imgHeight = img.height(),
				imgWidth = img.width(),
				parentHeight = parent.height(),
				parentWidth = parent.width();
			if (imgHeight>parentHeight && imgWidth<parentWidth)
			{
				img.css({'height':'100%','width':'auto'});
			}else if (imgHeight<parentHeight && imgWidth>parentWidth)
			{
				img.css({'width':'100%','height':'auto'});
			}else if (imgHeight>parentHeight && imgWidth>parentWidth)
			{
				if (imgHeight/imgWidth>parentHeight/parentWidth)
				{
					img.css({'height':'100%','width':'auto'});
				}else{
					img.css({'width':'100%','height':'auto'});
				}
			}else{
				img.css({'padding-top':(parentHeight-imgHeight)/2});
			}
		}

	})
 </script>
 </body>
</html>
