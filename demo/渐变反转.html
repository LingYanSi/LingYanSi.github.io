<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <link rel="stylesheet" href="css/reset.css">
  <link rel="shortcut icon" href="" />
  <title></title>
  <style type="text/css">
	  .rotate{position:fixed;top:0;left:0;height:100%;width:100%;-webkit-perspective:600px;cursor:default;}
	  .rotate-item{transform:rotateY(90deg) translateX(0);position:absolute;top:0;height:100%;width:100%;background-size:cover;opacity:0;
					transform-origin:50% 50% -320px;}
	  .change{transition:all .6s linear;transition-property:opacity,transform;}
	  .change-next{opacity:0;transform:rotateY(90deg) translateX(0);}
	  .change-current{opacity:1;transform:rotateY(0deg) translateX(0);}
	  .change-prev{opacity:0;transform:rotateY(-90deg) translateX(0);}
  </style>
 </head>
 <body>
	<div id="wrap" class="wrap">
		<div id="main" class="main">
			<div class="rotate">
				<div class="rotate-item change-current" style="background-image:url(img/night.jpg)"></div>
				<div class="rotate-item change-next" style="background-image:url(img/134.jpg)"></div>
				<div class="rotate-item change-next" style="background-image:url(img/1234.jpg)"></div>
			</div>
		</div>
	</div>
 <script src="js/jquery-1.11.2.min.js"></script>
 <script type="text/javascript">
	$(function(){
		var winHeight = $(window).height() ;
		var winWidth = $(window).width() ;
		document.getElementById('wrap').style.opacity = 1;
		$('.rotate-item').css({'transform-origin':'50% 50% -'+winWidth/2+'px'})
		var $item = $('.rotate-item') ;
		var len = $item.length ;
		var index = 0 ;
		var time = 0
		window.addEventListener('keyup',function(event){
			var newTime= new Date().getTime()
			if(newTime-time>600) time = newTime
			else return ;
			var keyCode = event.keyCode ;
			if (keyCode == 40 || keyCode == 39)
			{
				toWhere((index+1),'right');
				index = setPage(index+1) ;
			}else if (keyCode == 38 || keyCode == 37)
			{
				toWhere((index-1),'left');
				index = setPage(index-1) ;
			}
		});
		var $rotate = document.querySelector('.rotate'),
				item = [].slice.call($rotate.children) ,
				len = item.length ;
		touchEvent()
		function touchEvent(){
			var xx,yy,XX,YY,
				opaShow = 1,
				opaHide = 0,
				rotateYCur = 0,
				rotateYPrev = -90,
				rotateYNext = 90 ,
				currentDom,prevDom,nextDom,
				cha ,swipeX,swipeY;
			$rotate.addEventListener('mousedown',function(event){
				touchStart(event)
			},false);
			$rotate.addEventListener('mousemove',function(event){
				touchMove(event)
			},false);
			$rotate.addEventListener('mouseup',function(event){
				touchEnd(event);
			},false);
			function touchStart(event){
				cha = 0 ;
				XX = xx = event.targetTouches ? event.targetTouches[0].screenX : event.pageX ;
				YY = yy = event.targetTouches ? event.targetTouches[0].screenY : event.pageY ;
				index = setPage(index)
				currentDom = item[index] ;
				nextDom = item[index+1] ? item[index+1] : item[0];
				prevDom = item[index-1] ? item[index-1] : item[len-1] ;
				
				currentDom.classList.remove('change');
				nextDom.classList.remove('change');
				prevDom.classList.remove('change');
				swipeX = true , swipeY = true ;
			}
			function touchMove(event){
				if(!swipeX) return
				XX  = event.targetTouches ? event.targetTouches[0].screenX : event.pageX ;
				YY  = event.targetTouches ? event.targetTouches[0].screenY : event.pageY ;
				cha = XX - xx ;
				if (cha>0)
				{
					currentDom.style.opacity = 1-cha/winWidth +'' ;
					currentDom.style.transform = 'rotateY('+ (rotateYCur+(cha/winWidth)*90) +'deg)' ;
					prevDom.style.opacity = cha/winWidth +'' ;
					prevDom.style.transform = 'rotateY('+ (rotateYPrev+(cha/winWidth)*90) +'deg)' ;
				}else if (cha<0)
				{
					currentDom.style.opacity = 1+cha/winWidth +'' ;
					currentDom.style.transform = 'rotateY('+ (rotateYCur+(cha/winWidth)*90) +'deg)' ;
					nextDom.style.opacity = (-cha/winWidth) +'' ;
					nextDom.style.transform = 'rotateY('+ (rotateYNext+(cha/winWidth)*90) +'deg)' ;
				}
			}
			function touchEnd(event){
				if (cha>0)
				{
					currentDom.classList.add('change');
					prevDom.classList.add('change');
					currentDom.style.opacity = opaHide +'' ;
					currentDom.style.transform = 'rotateY('+ rotateYNext +'deg)' ;
					prevDom.style.opacity = opaShow +'' ;
					prevDom.style.transform = 'rotateY('+ rotateYCur +'deg)' ;
					index-- ;
				}else if (cha<0)
				{
					currentDom.classList.add('change');
					nextDom.classList.add('change');
					currentDom.style.opacity = opaHide +'' ;
					currentDom.style.transform = 'rotateY('+ rotateYPrev +'deg)' ;
					nextDom.style.opacity = opaShow +'' ;
					nextDom.style.transform = 'rotateY('+ rotateYCur +'deg)' ;
					index++
				}
				swipeX = false , swipeY = false ;
			}
		}
			function setPage(index){
				if(index>len-1) index=0 ;
				else if(index<0) index = len-1
				return index ;
			}
			function toWhere(toIndex,direction){
				var toIndex = setPage(toIndex);
				var nextDom = item[toIndex] ,
					currentDom = item[index] ;
				if (direction=='right')
				{
					nextDom.classList.remove('change');
					nextDom.style.opacity = '0' ;
					nextDom.style.transform = 'rotateY(90deg)';
					var x = nextDom.offsetWidth ;
					currentDom.classList.add('change');
					currentDom.style.opacity = '0' ;
					currentDom.style.transform = 'rotateY(-90deg)';
					nextDom.classList.add('change');
					nextDom.style.opacity = '1' ;
					nextDom.style.transform = 'rotateY(0deg)';
				}else if (direction=='left')
				{
					nextDom.classList.remove('change');
					nextDom.style.opacity = '0' ;
					nextDom.style.transform = 'rotateY(-90deg)';
					var x = nextDom.offsetWidth ;
					currentDom.classList.add('change');
					currentDom.style.opacity = '0' ;
					currentDom.style.transform = 'rotateY(90deg)';
					nextDom.classList.add('change');
					nextDom.style.opacity = '1' ;
					nextDom.style.transform = 'rotateY(0deg)';
				}
			}
	})
 </script>
 </body>
</html>
