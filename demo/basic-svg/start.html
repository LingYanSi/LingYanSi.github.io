<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title></title>
    <style media="screen">
        html {
            font-size: 50px;
        }

        * {
            margin: 0;
            padding: 0;
        }

        img {
            width: 100%;
        }

        #svg-circle,
        .transition {
            transition: all .3s;
        }

        #svg-circle:hover {
            fill: blue;
            /*stroke:*/
        }
    </style>
</head>

<body>
    <svg version="1.1" baseProfile="full" width="300" height="200" xmlns="http://www.w3.org/2000/svg">

        <rect width="100%" height="100%" fill="red" />

        <circle id="svg-circle" cx="150" cy="100" r="80" fill="green" />

        <text x="150" y="125" font-size="60" text-anchor="middle" fill="white">SVG</text>

    </svg>

    <button>what</button>
    <div class="" style="position:relative;">
        <div>
            <img src="http://s7.mogucdn.com/p1/160426/t0_ifqwgm3dgfrggnzshazdambqgyyde_750x750.gif" alt="">
        </div>
        <div style="position:absolute; top:0;left:0;width:100%;">
            <svg version="1.1" baseProfile="full" width="100%" height="20rem" xmlns="http://www.w3.org/2000/svg">

                <path id="heihei" d="M 10 75 Q 205 60 400 75 L400 400 L10 400 L10 75 " stroke="black" stroke-linecap="round" fill="#fff" />
            </svg>
        </div>
    </div>

    <script type="text/javascript">
        var $hei = document.querySelector('#heihei')

        var width = window.innerWidth
        var state = {
            chaCache: 0,
            transitionEnd: 1,
            chaY: 0
        }
        var ISPHONE = navigator.userAgent.toLowerCase().match(/phone/g)

        var mousedown = ISPHONE ? 'touchstart' : 'mousedown',
            mousemove = ISPHONE ? 'touchmove' : 'mousemove',
            mouseup = ISPHONE ? 'touchend' : 'mouseup',
            mouseleave = ISPHONE ? 'touchcancel' : 'mouseleave'


        document.querySelector('body').addEventListener(mousedown, function(event) {
            if (!state.transitionEnd) return
            state.y = event.pageY || event.touches[0].screenY
            state.able = true
        })
        document.querySelector('body').addEventListener(mousemove, function(event) {
            if (!state.able) return

            event.preventDefault()

            state.Y = event.pageY || event.touches[0].screenY
            state.chaY = state.Y - state.y
            $hei.setAttribute('d', path((state.chaCache + state.chaY)))
        })
        document.querySelector('body').addEventListener(mouseup, function(event) {
            state.chaCache = state.chaCache + state.chaY
            state.able = false

            if (state.chaCache == 0) {
                $hei.classList.remove('transition')
                state.transitionEnd = true
                return
            }
            if (ISPHONE) {
                state.transitionEnd = false
                animation()
            } else {
                $hei.classList.add('transition')
                $hei.clientWidth
                $hei.setAttribute('d', path())
            }
        })
        document.querySelector('body').addEventListener(mouseleave, function(event) {
            state.chaCache = state.chaCache + state.chaY
            state.able = false

            if (state.chaCache == 0) {
                $hei.classList.remove('transition')
                state.transitionEnd = true
                return
            }
            if (ISPHONE) {
                state.transitionEnd = false
                animation()
            } else {
                $hei.classList.add('transition')
                $hei.clientWidth
                $hei.setAttribute('d', path())
            }
        })

        $hei.addEventListener('transitionend', function() {
            this.classList.remove('transition')
            state.transitionEnd = true
            state.chaCache = 0
        })


        function path(v) {
            v = (isNaN(v) ? 0 : v) || 0
                // return `M 0 75 Q ${width/2} ${v+75} ${width} 75 L${width} ${width} L0 ${width} L0 75 `
            return 'M 0 75 Q ' + width / 2 + ' ' + (v + 75) + ' ' + width + ' 75 L' + width + ' ' + width + ' L0 ' + width + ' L0 75'
        }
        $hei.setAttribute('d', path())

        function animation() {
            // 一个简单的animate函数
            var cache = state.chaCache,
                time = .3,
                PER = Math.abs(cache / (time / .0168))

            function decrease() {
                if (cache > 0) {
                    state.chaCache = state.chaCache - PER
                    state.chaCache = state.chaCache < 0 ? 0 : state.chaCache
                } else {
                    state.chaCache = state.chaCache + PER
                    state.chaCache = state.chaCache > 0 ? 0 : state.chaCache
                }
                $hei.setAttribute('d', path(state.chaCache))
                if (state.chaCache == 0) {
                    state.transitionEnd = true
                    state.chaCache = 0
                    return
                }
                requestAnimationFrame(decrease)
            }
            requestAnimationFrame(decrease)
        }
        
    </script>
</body>

</html>
