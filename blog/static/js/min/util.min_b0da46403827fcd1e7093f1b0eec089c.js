"use strict";var __fetch=function(e){var t=function(e,t){return new Promise(function(o,n){var r=new XMLHttpRequest;r.addEventListener("progress",function(e){t.progress&&t.progress(e.loaded/e.total),console.log("progress",e)},!1),r.addEventListener("abort",function(e){n()},!1),r.addEventListener("error",function(e){n()},!1),r.addEventListener("load",function(e){},!1),r.upload.onprogress=function(e){t.uploadProgress&&t.uploadProgress(e.loaded/e.total)},r.open(t.method||"Get",e,!0);var i=t.body;!i instanceof window.FormData&&(i=JSON.stringify(i)),r.addEventListener("readystatechange",function(e){4==r.readyState&&o(r.responseText)}),r.send(i)})};return t.origin=e,t}(window.fetch),Queue=function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1];this.queue=[],this.fn=e;var o=this;this.tick=function(){this.queue.forEach(clearTimeout),this.queue.push(setTimeout(function(){o.fn()},t))}},Utils={time:{toString:function(e){var t=new Date((+e));return t.getFullYear()+"-"+this.fillZero(t.getMonth()+1)+"-"+this.fillZero(t.getDate())+" "+this.fillZero(t.getHours())+":"+this.fillZero(t.getMinutes())+":"+this.fillZero(t.getSeconds())},fillZero:function(e){return e<10?"0"+e:""+e}},lastPosition:{set:function(e,t){var o=Utils.getSessionStorage("lastPosition");o[e]=t,Utils.setSessionStorage("lastPosition",o)},get:function(e){var t=Utils.getSessionStorage("lastPosition"),o=t[e]||{};return o}},getSessionStorage:function(e){var t=window.sessionStorage.getItem(e)||"{}";try{t=JSON.parse(t)}catch(o){t={}}return t},setSessionStorage:function(e,t){window.sessionStorage.setItem(e,JSON.stringify(t))},scroll:function(){var e={},t=function(){console.log(e);for(var t in e)e[t]&&e[t]()},o=new Queue(t,50);window.addEventListener("scroll",function(){o.tick()});var n={listen:function(t,o){return e[t]=o,{detory:function(){n.remove(t)},key:t}},remove:function(t){delete e[t]},trigger:t,tick:o.tick.bind(o)};return n}(),loadImageUtil:{data:function e(t){var e=t.dataset,o=e.lazyImg;if(o)return{type:"layzImg",url:o};var n=e.lazyBgd;if(n)return{type:"lazyBgd",url:n};var r=e.lazyPoster;return r?{type:"lazyPoster",url:r}:void 0},setSrc:function(e,t){switch(console.log(t.type),t.type){case"layzImg":e.src=t.url;break;case"lazyBgd":e.style.backgroundImage="url("+t.url+")";break;case"lazyPoster":e.poster=t.url}},webp:function(){var e=void 0;return function(){return console.log("what the fuck",e),new Promise(function(t,o){if(e===!0)return void t();if(e===!1)return void o();var n=new Image;n.onload=function(){e=!0,t()},n.onerror=function(){e=!1,o()},n.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vlAAAA="})}}()},loadImage:function(){var e=this,t=Array.from(document.querySelectorAll(".lazy-load-img"));t.length&&t.some(function(t){var o=e.loadImageUtil.data(t),n=o.url;if(n){var r=t.getBoundingClientRect().top,i=t.clientHeight;if(!(r<-i)){if(r>window.innerHeight)return!0;var a=new Image;a.onload=a.onerror=a.onabort=function(){a.onload=a.onerror=a.onabort=null,a=null,e.loadImageUtil.setSrc(t,o)},t.classList.remove("lazy-load-img"),e.loadImageUtil.webp(n).then(function(e){return console.log("支持WEBP!!!!!!!!!!!!!")},function(e){return console.log("不支持WEBP")}),a.src=n,(a.width||a.height||a.complete)&&(a.onload=a.onerror=a.onabort=null,a=null,e.loadImageUtil.setSrc(t,o))}}})},fetch:__fetch};Utils.scroll.listen("lazy-load-img",Utils.loadImage.bind(Utils));