<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<title>react练习1</title>
</head>
<body>
	<div id="title"></div>
	<div id="example"></div>
	<script src="framework/JSXTransformer.js"></script>
	<script src="framework/react.min.js"></script>
	<script type="text/jsx">
	window.onload = function(){
		
		/*
		*  创建一个评论组件
		*/

		var Aaaa = React.createClass({ // react组件名首字母要大些，用意是为了和标准的html标签区分
			getInitialState:function(){
				return {
					nima : false
				}
			},
			handleClick:function(){
				this.setState( {nima: !this.state.nima } );
				// alert('我被点击了');
			},
			edit:function(){
				console.log('双击时间')
				// alert('时代发生的发')
				this.refs.name.getDOMNode().setAttribute('contentEditable',true);
			},
			save:function(event){ // 保存数据
				if(event.keyCode){
					if( event.keyCode == 27 ){

					}else if( event.keyCode != 27 && event.keyCode !=13 ) return ;
				}
				this.refs.name.getDOMNode().removeAttribute('contentEditable');
			},
			del:function(){ // 其实根据flux，增删改查，不应直接反映在v上，应该先走model，数据改变后，在反映到view上
				this.props.onDel();
			},
			render : function(){
				var nima = this.state.nima ? '周芷若' : '赵敏' ;
				return (
					<h1 ref="item"> 
						<span class="name" ref="name" onDoubleClick ={ this.edit } onBlur={ this.save } onKeyDown={ this.save }>胡耀邦</span> 
						<span class="age">122</span> 
						<span onClick={ this.handleClick }>Hello {this.props.data.name}{this.props.data.age}</span>
						<span onClick={ this.del }>删除</span>
					</h1>
				);
			}
		});

		var AddNote = React.createClass({ // 添加新条目组建
			handleClick:function(event){
				if( event.keyCode && event.keyCode != 13 ) return 
				if( this.refs.wName.getDOMNode().value && this.refs.wAge.getDOMNode().value ){
					this.props.onAdd(event,{ name:this.refs.wName.getDOMNode().value ,age:this.refs.wAge.getDOMNode().value });
					this.refs.wName.getDOMNode().value = '' ;
					this.refs.wAge.getDOMNode().value = '' ;
					// alert('创建成功')
				}else{
					alert('信息不完整')
				}
				//  新增一个item
			},
			clearAll : function(){
				// 清空所有
				this.props.onClear();
			},
			render : function(){
				return (<div>
					<input type="text" id="wName" ref="wName" placeholder="名字" onKeyDown={ this.handleClick } /> 
					<input type="number" id="wAge" ref="wAge" placeholder="年龄" onKeyDown={ this.handleClick } /> 
					<button onClick={this.handleClick}>提交</button>
					<button onClick={ this.clearAll }>清空</button>
					</div>);
			}
		});

		var data = [{name:'毛腊肉',age:'108'},
					{name:'地图开疆蒋中正',age:'120'}] ;

		var Comments = React.createClass({ // 主组件
			handleClick:function(event,item){
				// console.log('对方几乎是恐惧的');
				data.push(item)
				if(item){
					this.resetData();
					// console.log(this.state) 
				}
				/*this.props.data = [{name:'冰北库',age:'108'},
					{name:'地图开疆蒋中正',age:'120'}] ;*/

			},
			resetData : function(){
				this.setState({
					itemCounts : data
				});
			},
			clearAll : function(){
				data = [] ;
				this.resetData();
			},
			clearOne : function(ele,index){
				delete data[index] ;
				this.resetData();
			},
			getInitialState : function(){
				return {
					itemCounts : data
				}
			},
			render : function(){

				var items = this.state.itemCounts.map(function(ele,index){
					return <Aaaa data={ele} onDel={this.clearOne.bind(this,ele,index)}></Aaaa>
				},this)

				var mianStyle = { maxWidth:"900px" , margin:"0 auto" } ;
				var h1Style = { color:"rgb(247,105,105)" , fontSize:"3em" , lineHeight:"2" , textAlign:"center" } ;

				return (<div style={ mianStyle }>
					<h1 style={ h1Style } >React</h1>
					<AddNote onAdd={this.handleClick} onClear={this.clearAll} ></AddNote>
					<ol>{items}</ol>
				</div>);
			}
		});

		React.render(
			<Comments data={data} />,
			document.getElementById('example')
		);
	}
	</script>
	<script>
	/*document.querySelector('html').onkeydown = function(event){
		console.log(event.keyCode)
	}*/
	</script>
</body>
</html>