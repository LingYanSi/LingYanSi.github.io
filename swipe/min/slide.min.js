"use strict";var LunBo=function(){var fun=function fun(arg){if(arg=arg||{},!arg.id)return void console.warn("id不能为空");var $id=document.querySelector(arg.id),dataArr=eval($id.getAttribute("data-arr")),TOLEFT="left"===arg.direction,TIME=arg.time<1e3?1e3:arg.time,DOTT=void 0===arg.dottHidden?!0:arg.dottHidden,LOOP=void 0===arg.loop?!0:arg.loop,FLOW=void 0===arg.flow?!0:arg.flow,ISPHONE=window.navigator.userAgent.toLowerCase().match(/ipad|iphone|android/g),_transitionend=window.navigator.userAgent.toLowerCase().match("android")?"webkitTransitionEnd":"transitionend",dataArrExit=!0;dataArr&&Array.isArray(dataArr)&&dataArr.length||(dataArrExit=!1,dataArr=[].slice.call($id.firstElementChild.children).map(function(t){return 1}));var translateStore=[],transitionStore=[],LEN=dataArr.length,$items=[],$dotts=[],current=arg.current||0,oldCurrent,store={autoplay:arg.autoplay||!1,PREVSTATE:TOLEFT?"translate3d(-100%,0,0)":"translate3d(0,-100%,0)",CURRENTSTATE:"translate3d(0,0,0)",NEXTSTATE:TOLEFT?"translate3d(100%,0,0)":"translate3d(0,100%,0)"},touch={leftS:0,topS:0,cha:0,moveX:!1,moveY:!1,width:TOLEFT?$id.clientWidth:$id.clientHeight,height:$id.clientHeight,prev:0,current:current,next:0,isCanSwipe:0,swiping:0,transitionendNum:0};window.addEventListener("resize",function(){touch.width=$id.clientWidth,touch.height=$id.clientHeight});var RAF=function(t){window.requestAnimationFrame?requestAnimationFrame(t):t()},util={appendChild:function(){dataArrExit&&($id.innerHTML=' <div class="banner-items">\n                                     '+dataArr.map(function(t){return'<a href="'+t.link+'" style="background-image:url('+t.img+')" class="banner-item"></a>'}).join(" ")+'\n                                </div>\n                                <div class="banner-dotts" style="display:'+(1==LEN||DOTT?"none":"block")+'">\n                                    '+dataArr.map(function(t){return'<span class="banner-dott"></span>'}).join(" ")+"\n                                </div> "),$items=[].slice.call($id.firstElementChild.children),$dotts=DOTT?[].slice.call($id.lastElementChild.children):[]},setState:function(){translateStore.forEach(function(t,e){$items[e].style.cssText+=t}),this.currentChange()},currentChange:function(){!DOTT&&translateStore.forEach(function(t,e){e==current?$dotts[e].classList.add("current"):$dotts[e].classList.remove("current")})},setTranslateStore:function(t,e){translateStore[t]=this.autoprefix(e),$items[t].style.cssText+=translateStore[t]},initTranslateStore:function(t){var e=this;dataArr.forEach(function(t,r,n){r==current?translateStore.push(e.autoprefix(store.CURRENTSTATE)):translateStore.push(e.autoprefix(store.PREVSTATE))}),this.setState()},autoprefix:function(t){return";-webkit-transform:"+t+";transform:"+t+";"},handleTransition:function(t,e){void 0!==t?($items[t].classList.add("current"),transitionStore[t]=1):transitionStore.forEach(function(t,e,r){t&&$items[e].classList.remove("current"),r[e]=0})},touchStart:function(t){var e=this;if(touch.osSwipe=0,!touch.swiping){store.autoplay&&this.pause();var r=ISPHONE?t.touches[0]:t;return touch.leftS=r.clientX,touch.topS=r.clientY,ISPHONE&&TOLEFT&&(touch.leftS/touch.width<.05||touch.leftS/touch.width>.95)?void(touch.osSwipe=1):void requestAnimationFrame(function(){touch.prev=e.checkIndex(current-1,"prev"),touch.next=e.checkIndex(current+1,"next"),touch.current=current,touch.isCanSwipe=1,e.setTranslateStore(touch.current,store.CURRENTSTATE),e.setTranslateStore(touch.prev,store.PREVSTATE),e.setTranslateStore(touch.next,store.NEXTSTATE)})}},touchMove:function(t){var e=this;if(TOLEFT||(t.stopPropagation(),t.preventDefault()),!touch.swiping&&!touch.osSwipe&&touch.isCanSwipe){var r=ISPHONE?t.touches[0]:t,n=r.clientX,i=r.clientY;if(touch.moveX||!touch.moveY&&Math.abs(i-touch.topS)-Math.abs(n-touch.leftS)<0){if(touch.moveX=1,touch.moveY=0,!TOLEFT)return;if(touch.cha=n-touch.leftS,!FLOW)return t.stopPropagation(),void t.preventDefault();if(!LOOP&&(touch.cha<0&&current==LEN-1||touch.cha>0&&0==current)){var o=touch.cha;return requestAnimationFrame(function(){o>0&&console.log(touch.next,store.NEXTSTATE),o>0?e.setTranslateStore(touch.next,store.NEXTSTATE):e.setTranslateStore(touch.prev,store.PREVSTATE),e.setTranslateStore(touch.current,store.CURRENTSTATE)}),void(touch.cha=0)}t.stopPropagation(),t.preventDefault();var o=touch.cha;RAF(function(){touch.swiping||(this.setTranslateStore(current,"translate3d("+touch.cha/touch.width*100+"%,0,0)"),o>0&&(dataArr.length>2&&this.setTranslateStore(touch.next,store.NEXTSTATE),this.setTranslateStore(touch.prev,"translate3d("+(touch.cha-touch.width)/touch.width*100+"%,0,0)")),0>o&&(dataArr.length>2&&this.setTranslateStore(touch.prev,store.PREVSTATE),this.setTranslateStore(touch.next,"translate3d("+(touch.cha+touch.width)/touch.width*100+"%,0,0)")),arg.touchmove&&arg.touchmove(touch))}.bind(this))}if(touch.moveY||!touch.moveX&&Math.abs(i-touch.topS)-Math.abs(n-touch.leftS)>0){if(touch.moveX=0,touch.moveY=1,TOLEFT)return;if(touch.cha=i-touch.topS,!FLOW)return t.stopPropagation(),void t.preventDefault();if(!LOOP&&(touch.cha<0&&current==LEN-1||touch.cha>0&&0==current))return void(touch.cha=0);RAF(function(){touch.swiping||(this.setTranslateStore(current,"translate3d(0,"+touch.cha/touch.height*100+"%,0)"),touch.cha>0&&(dataArr.length>2&&this.setTranslateStore(touch.next,store.NEXTSTATE),this.setTranslateStore(touch.prev,"translate3d(0,"+(touch.cha-touch.height)/touch.height*100+"%,0)")),touch.cha<0&&(dataArr.length>2&&this.setTranslateStore(touch.prev,store.PREVSTATE),this.setTranslateStore(touch.next,"translate3d(0,"+(touch.cha+touch.height)/touch.height*100+"%,0)")),arg.touchmove&&arg.touchmove(touch))}.bind(this))}}},touchEnd:function(){return touch.swiping?void 0:(oldCurrent=current,FLOW?void RAF(function(){0!=touch.cha&&(touch.swiping=1,this.addEventListener()),touch.cha>0?(this.handleTransition(current),this.handleTransition(touch.prev),touch.prev!=touch.next&&this.setTranslateStore(touch.next,store.NEXTSTATE),$id.clientWidth,touch.cha/touch.width>.1?(this.setTranslateStore(current,store.NEXTSTATE),this.setTranslateStore(touch.prev,store.CURRENTSTATE),current=touch.prev):(this.setTranslateStore(current,store.CURRENTSTATE),this.setTranslateStore(touch.prev,store.PREVSTATE))):touch.cha<0&&(this.handleTransition(current),this.handleTransition(touch.next),touch.prev!=touch.next&&this.setTranslateStore(touch.prev,store.PREVSTATE),$id.clientWidth,touch.cha/touch.width<-.1?(this.setTranslateStore(current,store.PREVSTATE),this.setTranslateStore(touch.next,store.CURRENTSTATE),oldCurrent=current,current=touch.next):(this.setTranslateStore(current,store.CURRENTSTATE),this.setTranslateStore(touch.next,store.NEXTSTATE))),0!=touch.cha?oldCurrent!=current&&this.currentChange():(touch.swiping=0,store.autoplay&&this.run()),this.resetTouch(touch)}.bind(this)):arg.callback?(arg.callback(current,LEN,touch.cha,TOLEFT?touch.moveX:touch.moveY),void this.resetTouch(touch)):((TOLEFT?touch.moveX:touch.moveY)&&touch.cha/touch.width>.1&&this.prev(),(TOLEFT?touch.moveX:touch.moveY)&&touch.cha/touch.width<-.1&&this.next(),void this.resetTouch(touch)))},resetTouch:function(t){Object.keys(t).forEach(function(e){"width"!=e&&"height"!=e&&"swiping"!=e&&(t[e]=0)})},checkIndex:function(t,e){return t%=LEN,t="prev"==e?0>t?LEN-1:t:t>LEN-1?0:t},next:function(){this.goTo(current+1,"next")},goTo:function(t,e,r){return e=e||"next",touch.swiping=1,oldCurrent=current,current=this.checkIndex(t,e),current==oldCurrent?(touch.swiping=0,void this.goToCallback()):(this.addEventListener(),"next"==e?this.setTranslateStore(current,store.NEXTSTATE):this.setTranslateStore(current,store.PREVSTATE),this.handleTransition(),$id.clientWidth,this.handleTransition(oldCurrent),this.handleTransition(current),$id.clientWidth,"next"==e?this.setTranslateStore(oldCurrent,store.PREVSTATE):this.setTranslateStore(oldCurrent,store.NEXTSTATE),this.setTranslateStore(current,store.CURRENTSTATE),this.currentChange(),void(r&&this.gotToCallbackArr.push(r)))},prev:function(){this.goTo(current-1,"prev")},goToCallbackArr:[],goToCallback:function(){this.goToCallbackArr[0]&&(this.goToCallbackArr[0](current),this.goToCallbackArr.splice(0,1))},intervalArr:[],pause:function(){this.intervalArr.forEach(clearInterval),this.intervalArr.length=0},run:function(){!this.intervalArr.length&&this.intervalArr.push(setInterval(this.next.bind(this),TIME))},transitionend:function(){this.handleTransition(),store.autoplay&&this.run(),$items[oldCurrent].removeEventListener(_transitionend,fun),this.transitionendCallback(),this.goToCallback(),touch.swiping=0},transitionendCallback:function(){arg.transitionend&&arg.transitionend(current,oldCurrent,current!==oldCurrent,touch,store)},addEventListener:function(){$items[current].addEventListener(_transitionend,fun)},init:function(){var t=this;if(current=this.checkIndex(current),this.appendChild(),this.initTranslateStore(),!(1>=LEN)){this.transitionendCallback();ISPHONE?($id.firstElementChild.addEventListener("touchstart",this.touchStart.bind(this)),$id.firstElementChild.addEventListener("touchmove",this.touchMove.bind(this)),$id.firstElementChild.addEventListener("touchend",this.touchEnd.bind(this)),$id.firstElementChild.addEventListener("touchcancel",this.touchEnd.bind(this))):($id.firstElementChild.addEventListener("mousedown",this.touchStart.bind(this)),$id.firstElementChild.addEventListener("mousemove",this.touchMove.bind(this)),$id.firstElementChild.addEventListener("mouseup",this.touchEnd.bind(this)),$id.firstElementChild.addEventListener("mouseleave",this.touchEnd.bind(this))),document.addEventListener("visibilitychange",function(){store.autoplay&&(document.hidden?t.pause():t.transitionend())}),store.autoplay&&this.run()}}},fun=util.transitionend.bind(util);return util.init(),util};return fun}();