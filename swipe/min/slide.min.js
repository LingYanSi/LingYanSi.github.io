"use strict";var LunBo=function(){var fun=function fun(arg){if(arg=arg||{},!arg.id)return void console.warn("id不能为空");var $id=document.querySelector(arg.id),dataArr=eval($id.getAttribute("data-arr"));if(!dataArr||!Array.isArray(dataArr)||!dataArr.length)return void console.warn("数据为空");var translateStore=[],transitionStore=[],LEN=dataArr.length,$items=[],$dotts=[],current=arg.current||0,store={autoplay:arg.autoplay||!1,PREVSTATE:"translate3d(-100%,0,0)",CURRENTSTATE:"translate3d(0,0,0)",NEXTSTATE:"translate3d(100%,0,0)"},touch={leftS:0,topS:0,cha:0,moveX:!1,moveY:!1,width:$id.clientWidth,prev:0,next:0,isCanSwipe:1,swiping:0,transitionendNum:0};window.addEventListener("resize",function(){touch.width=$id.clientWidth});var util={appendChild:function(){$id.innerHTML=' <div class="banner-items">\n                                 '+dataArr.map(function(t){return'<a href="'+t.link+'" style="background-image:url('+t.img+')" class="banner-item"></a>'}).join(" ")+'\n                            </div>\n                            <div class="banner-dotts" style="display:'+(1==LEN?"none":"block")+'">\n                                '+dataArr.map(function(t){return'<span class="banner-dott"></span>'}).join(" ")+"\n                            </div> ",$items=[].slice.call($id.firstElementChild.children),$dotts=[].slice.call($id.lastElementChild.children)},setState:function(){translateStore.forEach(function(t,e){$items[e].style.cssText+=t}),this.currentChange()},currentChange:function(){translateStore.forEach(function(t,e){e==current?$dotts[e].classList.add("current"):$dotts[e].classList.remove("current")})},setTranslateStore:function(t,e){translateStore[t]=this.autoprefix(e),$items[t].style.cssText+=translateStore[t]},initTranslateStore:function(t){var e=this;dataArr.forEach(function(t,n,r){transitionStore.push(0),n==current?translateStore.push(e.autoprefix("translate3d(0,0,0)")):translateStore.push(e.autoprefix("translate3d(-100%,0,0)"))}),this.setState()},autoprefix:function(t){return";transform:"+t+";-moz-transform:"+t+";-webkit-transform:"+t},handleTransition:function(t,e){var n=this;void 0!==t?($items[t].classList.add("current"),transitionStore[t]=1):transitionStore.forEach(function(t,e,r){t&&$items[e].classList.remove("current"),r[e]=0,e!=current&&e!=n.checkIndex(current-1,"prev")&&e!=n.checkIndex(current+1,"next")?$items[e].style.visibility="hidden":$items[e].style.visibility="visible"})},touchStart:function(){if(touch.isCanSwipe){store.autoplay&&this.clearInterval();var t=event.touches[0];touch.leftS=t.pageX,touch.topS=t.pageY,touch.prev=this.checkIndex(current-1,"prev"),touch.next=this.checkIndex(current+1,"next"),touch.swiping=1}},touchMove:function(){if(touch.isCanSwipe&&touch.swiping){var t=event.touches[0],e=t.pageX,n=t.pageY;(touch.moveX||!touch.moveY&&Math.abs(n-touch.topS)-Math.abs(e-touch.leftS)<0)&&(touch.cha=e-touch.leftS,event.preventDefault(),touch.moveX=1,this.setTranslateStore(current,"translate3d("+touch.cha/touch.width*100+"%,0,0)"),touch.cha>0&&(dataArr.length>2&&this.setTranslateStore(touch.next,"translate3d(100%,0,0)"),this.setTranslateStore(touch.prev,"translate3d("+(touch.cha-touch.width)/touch.width*100+"%,0,0)")),touch.cha<0&&(dataArr.length>2&&this.setTranslateStore(touch.prev,"translate3d(-100%,0,0)"),this.setTranslateStore(touch.next,"translate3d("+(touch.cha+touch.width)/touch.width*100+"%,0,0)"))),(touch.moveY||!touch.moveX&&Math.abs(n-touch.topS)-Math.abs(e-touch.leftS)>0)&&(touch.moveY=1)}},touchEnd:function(){if(touch.isCanSwipe&&touch.swiping){var t=current;touch.cha>0?(this.handleTransition(current),this.handleTransition(touch.prev),touch.cha/touch.width>.2?(this.setTranslateStore(current,store.NEXTSTATE),this.setTranslateStore(touch.prev,store.CURRENTSTATE),current=touch.prev):(this.setTranslateStore(current,store.CURRENTSTATE),this.setTranslateStore(touch.prev,store.PREVSTATE))):touch.cha<0&&(this.handleTransition(current),this.handleTransition(touch.next),touch.cha/touch.width<-.2?(this.setTranslateStore(current,store.PREVSTATE),this.setTranslateStore(touch.next,store.CURRENTSTATE),current=touch.next):(this.setTranslateStore(current,store.CURRENTSTATE),this.setTranslateStore(touch.next,store.NEXTSTATE))),0!=touch.cha?(touch.isCanSwipe=0,touch.swiping=0,t!=current&&this.currentChange()):store.autoplay&&this.setInterval(),this.resetTouch(touch)}},resetTouch:function(t){Object.keys(t).forEach(function(e){"width"!=e&&"isCanSwipe"!=e&&(t[e]=0)})},checkIndex:function(t,e){return t="prev"==e?0>t?LEN-1:t:t>LEN-1?0:t},next:function(){touch.isCanSwipe=0;var t=current;current=this.checkIndex(current+1,"next"),this.setTranslateStore(current,store.NEXTSTATE),$id.clientWidth,this.handleTransition(t),this.handleTransition(current),this.setTranslateStore(t,store.PREVSTATE),this.setTranslateStore(current,store.CURRENTSTATE),this.currentChange()},prev:function(){touch.isCanSwipe=0;var t=current;current=this.checkIndex(current-1,"prev"),this.setTranslateStore(current,store.PREVSTATE),$id.clientWidth,this.handleTransition(t),this.handleTransition(current),this.setTranslateStore(t,store.NEXTSTATE),this.setTranslateStore(current,store.CURRENTSTATE),this.currentChange()},intervalArr:[],clearInterval:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){this.intervalArr.forEach(clearInterval),this.intervalArr.length=0}),setInterval:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){!this.intervalArr.length&&this.intervalArr.push(setInterval(this.next.bind(this),6e3))}),transitionend:function(){this.handleTransition(),touch.transitionendNum=0,touch.isCanSwipe=1,store.autoplay&&this.setInterval()},init:function(){var t=this;if(current=this.checkIndex(current),this.appendChild(),this.initTranslateStore(),!(1>=LEN)){store.autoplay&&this.setInterval();var e=window.navigator.userAgent.toLowerCase().match("android")?"webkitTransitionEnd":"transitionend";$items.forEach(function(n){n.addEventListener(e,function(){touch.transitionendNum++,2==touch.transitionendNum&&t.transitionend()})}),$id.addEventListener("touchstart",this.touchStart.bind(this)),$id.addEventListener("touchmove",this.touchMove.bind(this)),$id.addEventListener("touchend",this.touchEnd.bind(this)),document.addEventListener("visibilitychange",function(){store.autoplay&&(document.hidden?t.clearInterval():(t.transitionend(),alert(1)))})}}};util.init()};return fun}();